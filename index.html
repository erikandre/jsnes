<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Retro Championship</title>
    <style>
    @font-face {
      font-family: Retro;
      src: url(8bit.ttf);
      font-weight: bold;
    }

    div {
      margin-bottom: 5px;
      font-family: Retro;
    }
    </style>
    <link rel="apple-touch-icon" sizes="57x57" href="/fav.ico/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/fav.ico/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/fav.ico/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/fav.ico/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/fav.ico/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/fav.ico/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/fav.ico/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/fav.ico/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/fav.ico/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="/fav.ico/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/fav.ico/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/fav.ico/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/fav.ico/favicon-16x16.png">
    <link rel="manifest" href="/fav.ico/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/fav.ico/ms-icon-144x144.png">
</head>

<body>
    <center>
      <table>
          <tr>
              <th><div>Team 1</div></th>
              <th><div>Team 2</div></th>
          </tr>
          <tr>
              <td><div id="emulator1"></div></td>
              <td><div id="emulator2"></div></td>
          </tr>
      </table>
    </center>

    <script src="lib/jquery-1.4.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="lib/dynamicaudio-min.js" type="text/javascript" charset="utf-8"></script>
    <script src="source/nes.js" type="text/javascript" charset="utf-8"></script>
    <script src="source/utils.js" type="text/javascript" charset="utf-8"></script>
    <script src="source/cpu.js" type="text/javascript" charset="utf-8"></script>
    <script src="source/keyboard.js" type="text/javascript" charset="utf-8"></script>
    <script src="source/mappers.js" type="text/javascript" charset="utf-8"></script>
    <script src="source/papu.js" type="text/javascript" charset="utf-8"></script>
    <script src="source/ppu.js" type="text/javascript" charset="utf-8"></script>
    <script src="source/rom.js" type="text/javascript" charset="utf-8"></script>
    <script src="source/ui.js" type="text/javascript" charset="utf-8"></script>
    <script src="source/socket.io.js"></script>
    <script type="text/javascript" charset="utf-8">
        var nes;
        var nes2;
        $(function() {
            nes = new JSNES({
                'ui': $('#emulator1').JSNESUI({
                    "Homebrew": [
                        ['Concentration Room', 'roms/croom/croom.nes'],
                        ['LJ65', 'roms/lj65/lj65.nes'],
                    ],
                    "Working": [
                        ['Super Mario Bros.', 'local-roms/Super Mario Bros (E).nes'],
                        ['Ice Climber', 'local-roms/Ice Climber (U).nes'],
                        ['Bubble Bobble', 'local-roms/Bubble Bobble (E).nes'],
                        ['Tetris', 'local-roms/Tetris (U).nes'],
                        ['Contra', 'local-roms/Contra (U) [!].nes'],
                        ['Ninja Gaiden', 'local-roms/Ninja Gaiden (U).nes'],
                        ['1942', 'local-roms/1942 (PC10).nes'],
                    ],
                })
            });
            nes2 = new JSNES({
                'ui': $('#emulator2').JSNESUI({
                    "Homebrew": [
                        ['Concentration Room', 'roms/croom/croom.nes'],
                        ['LJ65', 'roms/lj65/lj65.nes'],
                    ],
                    "Working": [
                        ['Super Mario Bros.', 'local-roms/Super Mario Bros (E).nes'],
                        ['Ice Climber', 'local-roms/Ice Climber (U).nes'],
                        ['Bubble Bobble', 'local-roms/Bubble Bobble (E).nes'],
                        ['Tetris', 'local-roms/Tetris (U).nes'],
                        ['Contra', 'local-roms/Contra (U) [!].nes'],
                        ['Ninja Gaiden', 'local-roms/Ninja Gaiden (U).nes'],
                        ['1942', 'local-roms/1942 (PC10).nes'],
                    ],
                })
            });


            const socket1 = connectSocket(nes, 'emu-1');
            const socket2 = connectSocket(nes2, 'emu-2');

            function connectSocket(nes, name) {
              //var socket = io("http://localhost:3000");
              var socket = io("http://ec2-35-176-154-104.eu-west-2.compute.amazonaws.com/");
              socket.on('input', function(msg){
                var button = 0;
                switch (~~msg.button) {
                  case 0: button = 88; break; // A
                  case 1: button = 90; break; // B
                  case 2: button = 37; break; // Left
                  case 3: button = 39; break; // Right
                  case 4: button = 38; break; // Up
                  case 5: button = 40; break; // Down
                  case 6: button = 17; break; // Select
                  case 7: button = 13; break; // Start
                }
                var event = {
                  'keyCode': button
                };
                if (msg.action == 'down') {
                  nes.keyboard.keyDown(event);
                }
                else if (msg.action == 'up') {
                  nes.keyboard.keyUp(event);
                }
              });
              socket.on('hello', function(msg){
                socket.emit('register', name);
              });
              return socket;
            }
        });
    </script>

</body>
</html>
