<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>JSNES: A JavaScript NES emulator</title>
</head>

<body>
    <table>
        <tr>
            <th>Team 1</th>
            <th>Team 2</th>
        </tr>
        <tr>
            <td><div id="emulator1"></div></td>
            <td><div id="emulator2"></div></td>
        </tr>
    </table>

    <script src="lib/jquery-1.4.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="lib/dynamicaudio-min.js" type="text/javascript" charset="utf-8"></script>
    <script src="source/nes.js" type="text/javascript" charset="utf-8"></script>
    <script src="source/utils.js" type="text/javascript" charset="utf-8"></script>
    <script src="source/cpu.js" type="text/javascript" charset="utf-8"></script>
    <script src="source/keyboard.js" type="text/javascript" charset="utf-8"></script>
    <script src="source/mappers.js" type="text/javascript" charset="utf-8"></script>
    <script src="source/papu.js" type="text/javascript" charset="utf-8"></script>
    <script src="source/ppu.js" type="text/javascript" charset="utf-8"></script>
    <script src="source/rom.js" type="text/javascript" charset="utf-8"></script>
    <script src="source/ui.js" type="text/javascript" charset="utf-8"></script>
    <script src="source/socket.io.js"></script>
    <script type="text/javascript" charset="utf-8">
        var nes;
        var nes2;
        $(function() {
            nes = new JSNES({
                'ui': $('#emulator1').JSNESUI({
                    "Homebrew": [
                        ['Concentration Room', 'roms/croom/croom.nes'],
                        ['LJ65', 'roms/lj65/lj65.nes'],
                    ],
                    "Working": [
                        ['Mario Bros.', 'local-roms/Super Mario Bros (E).nes'],
                    ],
                })
            });
            nes2 = new JSNES({
                'ui': $('#emulator2').JSNESUI({
                    "Homebrew": [
                        ['Concentration Room', 'roms/croom/croom.nes'],
                        ['LJ65', 'roms/lj65/lj65.nes'],
                    ],
                    "Working": [
                        ['Mario Bros.', 'local-roms/Super Mario Bros (E).nes'],
                    ],
                })
            });


            const socket1 = connectSocket(nes, 'emu-1');
            const socket2 = connectSocket(nes2, 'emu-2');

            function connectSocket(nes, name) {
              var socket = io("http://localhost:3000");
              socket.on('input', function(msg){
                var button = 0;
                switch (msg.button) {
                  case '0': button = 88; break; // A
                  case '1': button = 90; break; // B
                  case '2': button = 37; break; // Left
                  case '3': button = 39; break; // Right
                  case '4': button = 38; break; // Up
                  case '5': button = 40; break; // Down
                  case '6': button = 17; break; // Select
                  case '7': button = 13; break; // Start
                }
                var event = {
                  'keyCode': button
                };
                if (msg.action == 'down') {
                  nes.keyboard.keyDown(event);
                }
                else if (msg.action == 'up') {
                  nes.keyboard.keyUp(event);
                }
              });
              socket.on('hello', function(msg){
                socket.emit('register', name);
              });
              return socket;
            }
        });
    </script>

</body>
</html>
